<div class="container mx-auto p-4">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">Gestión de Inventarios</h1>

        <div class="flex gap-4 items-center">
            <!-- Selector de Restaurante para SuperAdmin -->
            <mat-form-field appearance="outline" *ngIf="isGlobalAdmin" class="w-64">
                <mat-label>Restaurante</mat-label>
                <mat-select [value]="selectedRestaurantId" (selectionChange)="onRestaurantSelectionChange($event)">
                    <mat-option *ngFor="let rest of restaurantes" [value]="rest.id">
                        {{ rest.nombre }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <button mat-raised-button color="primary" [disabled]="!selectedRestaurantId || isLoading"
                (click)="iniciarNuevoInventario()">
                <mat-icon>add_circle</mat-icon>
                Nuevo Inventario
            </button>
        </div>
    </div>

    <!-- State: No Restaurant Selected -->
    <div *ngIf="!selectedRestaurantId"
        class="text-center p-8 bg-gray-50 rounded-lg border border-dashed border-gray-300">
        <mat-icon class="text-gray-400 text-6xl w-16 h-16 mb-4">store</mat-icon>
        <h3 class="text-xl font-medium text-gray-700">Seleccione un Restaurante</h3>
        <p class="text-gray-500 mt-2">Para ver y gestionar inventarios, por favor seleccione un restaurante en el menú
            superior.</p>
    </div>

    <!-- State: Loading -->
    <div *ngIf="isLoading" class="flex justify-center p-12">
        <mat-spinner diameter="40"></mat-spinner>
    </div>

    <!-- State: List -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" *ngIf="selectedRestaurantId && !isLoading">

        <!-- Empty State -->
        <div *ngIf="inventarios.length === 0" class="col-span-full text-center p-8 bg-gray-50 rounded-lg">
            <p class="text-gray-500">No hay inventarios registrados para este restaurante.</p>
        </div>

        <mat-card *ngFor="let inv of inventarios"
            class="inventario-card hover:shadow-lg transition-shadow cursor-pointer"
            (click)="continuarInventario(inv.id)">
            <mat-card-header>
                <div mat-card-avatar class="bg-blue-100 flex items-center justify-center rounded-full text-blue-600">
                    <mat-icon>{{ inv.estado === EstadoInventario.EnProgreso ? 'edit' : 'assignment_turned_in'
                        }}</mat-icon>
                </div>
                <mat-card-title class="text-lg">{{ inv.nombre }}</mat-card-title>
                <mat-card-subtitle>{{ inv.fechaInicio | date:'medium' }}</mat-card-subtitle>
            </mat-card-header>

            <mat-card-content class="mt-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">Estado:</span>
                    <mat-chip-set>
                        <mat-chip [color]="inv.estado === EstadoInventario.EnProgreso ? 'accent' : 'primary'" selected>
                            {{ inv.estado === EstadoInventario.EnProgreso ? 'En Progreso' : 'Completado' }}
                        </mat-chip>
                    </mat-chip-set>
                </div>

                <div class="stats grid grid-cols-2 gap-2 mt-4 text-sm">
                    <div class="bg-gray-50 p-2 rounded">
                        <span class="block text-gray-500 mb-1">Contados</span>
                        <span class="font-bold text-lg">{{ inv.productosContados }}</span>
                    </div>
                    <!-- More stats can be added here if available in summary -->
                </div>
            </mat-card-content>

            <mat-card-actions align="end">
                <button mat-button color="warn" [disabled]="isLoading" (click)="eliminarInventario($event, inv)">
                    <mat-icon>delete</mat-icon>
                    ELIMINAR
                </button>
                <button mat-button color="primary">
                    {{ inv.estado === EstadoInventario.EnProgreso ? 'CONTINUAR' : 'VER DETALLES' }}
                </button>
            </mat-card-actions>
        </mat-card>

    </div>
</div>